- title 'Blog', false

- content_for :sidebar do

  .d-grid.gap-2
    = link_to [:new, :post], class: 'btn btn-success' do
      %i.bi-plus-lg
      New Blog Post

  %hr
  %h3 Visitors
  %ul.list-unstyled
    - User.where.not(id: current_user.id).viewed_blog_at_desc.limit(8).each do |user|
      %li
        %strong= user.name
        &mdash;
        = time_tag user.viewed_blog_at, is: 'relative-time', title: l(user.viewed_blog_at) do
          = time_ago_in_words user.viewed_blog_at
          ago

  %hr
  %h3 Comments
  %ul.list-unstyled
    - Comment.created_at_desc.limit(5).each_with_index do |comment, i|
      %li
        %strong= comment.user.try(:name)
        &mdash;
        = time_tag comment.created_at, is: 'relative-time', title: l(comment.created_at) do
          = time_ago_in_words comment.created_at
          ago

  - if Post.post_tag_counts.present?
    %hr
    %h3 Tags
    - tag_cloud(Post.tag_counts_on(:post_tags).order(:name), %w(1 2 3 4)) do |tag, frequency|
      = link_to tag.name, posts_path(tag: tag.name), style: "font-size: #{frequency.to_i * 0.5}em"

  %hr
  %h3 Search
  = form_with url: :posts, method: :get do |f|
    .mb-3
      = f.label :ends_on, 'Date', class: 'form-label'
      = f.date_field :ends_on, value: @ends_on, class: 'form-control'
    .mb-3
      = f.label :term
      = f.text_field :term, value: params[:term], class: 'form-control', placeholder: 'Search term'
    .mb-3.d-grid
      = f.submit 'Search', class: 'btn btn-primary'

  = render partial: '/shared/calendar', locals: { starts_at: Post.order(at: :asc).first&.at, resource: :posts }

= render @future_posts

- if @past_posts.empty?
  .jumbotron
    %h2 Nothing to see here.
    %p Apparently, we're not that interesting. :)
    = link_to 'Show all posts', :posts
- else
  = render @past_posts
  = paginate @past_posts
